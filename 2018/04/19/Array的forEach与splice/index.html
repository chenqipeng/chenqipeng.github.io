<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><meta http-equiv="X-UA-Compatible" content="ie=edge"><title>Stuff</title></head><body><header><nav><ul><li><a href="/">Stuff</a></li><li><ul><li><a href="/categories/stuff">stuff</a></li></ul></li><li><ul><li><a href="/tags/Javascript">Javascript</a></li><li><a href="/tags/DOM">DOM</a></li><li><a href="/tags/Event">Event</a></li><li><a href="/tags/Markdown">Markdown</a></li><li><a href="/tags/CSS">CSS</a></li><li><a href="/tags/计算机原理">计算机原理</a></li></ul></li></ul></nav></header><main><article><h2>Array的forEach与splice</h2><div><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">this</span>.multipleSelection.forEach(<span class="function"><span class="keyword">function</span> (<span class="params">item, index</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (selectRow.waresId == item.waresId) &#123;</span><br><span class="line">        <span class="keyword">this</span>.multipleSelection.splice(index, <span class="number">1</span>);</span><br><span class="line">        exist = <span class="literal">true</span>;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;, <span class="keyword">this</span>);</span><br></pre></td></tr></table></figure>
<p>以上一段代码在实际运行中，由于<code>waresId</code>是唯一标识，所以不会产生预料之外的异常。但在<code>forEach</code>中使用<code>splice</code>，在某些情况下是会发生一些预料之外的异常的。如下：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> ary = [<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">3</span>,<span class="number">5</span>,<span class="number">6</span>,<span class="number">7</span>,<span class="number">8</span>,<span class="number">9</span>]</span><br><span class="line"></span><br><span class="line">ary.forEach(<span class="function">(<span class="params">item, index</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">if</span>(item % <span class="number">3</span> === <span class="number">0</span>) &#123;</span><br><span class="line">    ary.splice(index, <span class="number">1</span>)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">//ary:[1, 2, 3, 5, 7, 8]</span></span><br></pre></td></tr></table></figure>
<p>业务逻辑本意是删除3的倍数，然而最后结果却是<code>[1, 2, 3, 5, 7, 8]</code>，结果中依然包含一个3。<br>本例中，由于<code>splice</code>函数修改了数组，导致第二个3没有如期待的那样进入循环迭代，所以没有被删除掉。</p>
<ol>
<li>在《JS函数式编程指南》中，曾批评过<code>splice</code>，原因是<code>splice</code>不是一个<em>纯函数</em>，调用<code>splice</code>可能会发生一些无法观察到变化，致使程序异常。</li>
<li>抛开<code>splice</code>函数来说，也应尽量不在数组的循环中做修改数组长度的操作，避免出现异常。</li>
</ol>
</div></article></main><footer> </footer></body></html>